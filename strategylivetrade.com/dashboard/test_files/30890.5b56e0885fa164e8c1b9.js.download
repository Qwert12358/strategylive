"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[30890],{927301:(e,t,s)=>{s.r(t),s.d(t,{capitalizeFirstLetterInWord:()=>m,decodeHTMLEntities:()=>l,encodeHTMLEntities:()=>h,getFirstSegmentOrCodePointString:()=>g,htmlEscape:()=>c,removeSpaces:()=>_,removeTags:()=>u});const n=/[<"'&>]/g,o=e=>`&#${e.charCodeAt(0)};`,i={"&lt;":"<","&gt;":">","&quot;":'"',"&apos;":"'","&amp;":"&","&#60;":"<","&#62;":">","&#34;":'"',"&#39;":"'","&#039;":"'","&#38;":"&"},r=Object.assign({},...Object.entries(i).map((([e,t])=>({[t]:e})))),a=new RegExp(Object.keys(i).join("|"),"g"),d=new RegExp(Object.keys(r).join("|"),"g");function l(e){return e.replace(a,(e=>i[e]||e))}function h(e){return e.replace(d,(e=>r[e]||e))}function c(e){return e.replace(n,o)}function u(e=""){return e.replace(/(<([^>]+)>)/gi,"")}function _(e=""){return e.replace(/\s+/g,"")}function m(e=""){return e.replace(/\b\w/g,(e=>e.toUpperCase()))}function g(e){const t=Intl.Segmenter;if(t){const s=new t(void 0,{granularity:"grapheme"}),[{segment:n}={segment:null}]=s.segment(e);return n?.toUpperCase()??null}{const t=e.codePointAt(0);return t?String.fromCodePoint(t).toUpperCase():null}}},100366:(e,t,s)=>{async function n(){return(await Promise.all([s.e(27741),s.e(61171),s.e(87682),s.e(82321),s.e(20139)]).then(s.bind(s,254543))).ErrorCardRenderer}s.d(t,{getErrorCardRenderer:()=>n})},49437:(e,t,s)=>{const{getLogger:n}=s(735566),o=n("TVLocalStorage");var i=function(){try{this.isAvailable=!0,this.localStorage=window.localStorage,this.localStorage.setItem("tvlocalstorage.available","true")}catch(e){delete this.isAvailable,delete this.localStorage}this._updateLength();try{this._report()}catch(e){}};i.prototype._report=function(){if(this.isAvailable){const e=10,t=[];for(let e=0;e<this.localStorage.length;e++){const s=this.key(e);t.push({key:s,length:String(this.getItem(s)).length})}t.sort(((e,t)=>t.length-e.length));const s=t.slice(0,e);t.sort(((e,t)=>t.key.length-e.key.length));const n=t.slice(0,e);o.logNormal(`Total amount of keys in Local Storage: ${this.length}`),o.logNormal(`Top ${e} keys with longest values: ${JSON.stringify(s)}`),o.logNormal(`Top ${e} longest key names: ${JSON.stringify(n)}`);try{navigator.storage.estimate().then((e=>{o.logNormal(`Storage estimate: ${JSON.stringify(e)}`)}))}catch(e){}}},i.prototype.length=0,i.prototype.isAvailable=!1,i.prototype.localStorage={"tvlocalstorage.available":"false"},i.prototype._updateLength=function(){if(this.isAvailable)this.length=this.localStorage.length;else{var e,t=0;for(e in this.localStorage)this.localStorage.hasOwnProperty(e)&&t++;this.length=t}},i.prototype.key=function(e){return this.isAvailable?this.localStorage.key(e):Object.keys(this.localStorage)[e]},i.prototype.getItem=function(e){return this.isAvailable?this.localStorage.getItem(e):void 0===this.localStorage[e]?null:this.localStorage[e]},i.prototype.setItem=function(e,t){this.isAvailable?this.localStorage.setItem(e,t):this.localStorage[e]=t,this._updateLength()},i.prototype.removeItem=function(e){
this.isAvailable?this.localStorage.removeItem(e):delete this.localStorage[e],this._updateLength()},i.prototype.clear=function(){this.isAvailable?this.localStorage.clear():this.localStorage={},this._updateLength()},window.TVLocalStorage=new i,e.exports.TVLocalStorage=window.TVLocalStorage},849204:(e,t,s)=>{s.d(t,{LogoSize:()=>n,getLogoUrlResolver:()=>d});var n,o=s(650151),i=s(588948);!function(e){e[e.Medium=0]="Medium",e[e.Large=1]="Large"}(n||(n={}));class r{constructor(e){(0,o.assert)(""!==e,"S3 base url must be a non-empty string"),this._baseUrl=e}getSymbolLogoUrl(e,t){switch((0,o.assert)(""!==e,"logo id must be a non-empty string"),t){case n.Medium:return this._baseUrl+`${e}.svg`;case n.Large:return this._baseUrl+`${e}--big.svg`}}collectSymbolLogoUrls(e,t){const{logoId:s,baseCurrencyLogoId:o,currencyLogoId:i}=e;if(s)return[this.getSymbolLogoUrl(s,t)];const r=[];if(o&&r.push(this.getSymbolLogoUrl(o,t)),i&&r.push(this.getSymbolLogoUrl(i,n.Medium)),r.length<2)return r;const a=r.some((e=>l(e))),d=r.every((e=>!e.includes("country")||l(e)));return a&&d?r.filter((e=>!l(e))):r;function l(e){return e.includes("country/US")}}getCountryFlagUrl(e,t){return this.getSymbolLogoUrl("country/"+e,t)}getCryptoLogoUrl(e,t){return this.getSymbolLogoUrl("crypto/"+e,t)}getProviderLogoUrl(e,t){return this.getSymbolLogoUrl("provider/"+e,t)}getSourceLogoUrl(e,t){return this.getSymbolLogoUrl("source/"+e,t)}getBlockchainContractLogoUrl(e,t){return this.getSymbolLogoUrl("blockchain/"+e,t)}}let a;function d(){return function(){if(!a){const e=(0,i.getInitData)(),t=e.settings?e.settings.S3_LOGO_SERVICE_BASE_URL:"";a=new r(t)}return a}()}},957259:(e,t,s)=>{s.d(t,{TVChartApi:()=>ne});var n=s(154834),o=s(290484),i=s(569708),r=s(650151),a=s(735566),d=s(37010),l=s(181929),h=s(931924),c=s(894645),u=s(13692),_=s(496499),m=s(803155),g=s(803912),p=s(659923),f=s(925049),y=s(107447),b=s(800828),C=s(778016),S=s(125226),w=s(849204),k=s(314802),v=s(175203),R=s(982367),M=s(820028),q=s(646244),T=s(241361),N=s(403526),D=s(903656);const P=(0,a.getLogger)("Chart.Studies.StudyMetaInfoRepository",{color:"#606"}),L=(0,a.getLogger)("ChartApi.TrafficMeter",{maxCount:20,color:"#268"}),I=(0,a.getLogger)("ChartApi.Core",{color:"#706"}),H=(0,a.getLogger)("ChartApi.ChartSession",{color:"#706"}),A=(0,a.getLogger)("ChartApi.ChartSession",{highRate:!0,maxCount:100,color:"#706"}),E=(0,a.getLogger)("ChartApi.ChartSession",{maxCount:0,color:"#706"}),U=(0,a.getLogger)("ChartApi.ChartSession",{maxCount:50,color:"#706"}),O=(0,a.getLogger)("ChartApi.QuoteSession",{maxCount:50,color:"#660"}),B=(0,a.getLogger)("ChartApi.QuoteSession",{highRate:!0,maxCount:10,color:"#660"}),$=!(0,k.isOnMobileAppPage)("any"),x=(0,S.isFeatureEnabled)("broker_id_session");let Q=!1,V=!1,W=!1;const F=["","KB","MB","GB","TB"];function j(e){if(0===e)return"0";const t=(0,R.toInt)(Math.floor(Math.log(e)/Math.log(1024)));return(e/Math.pow(1024,t)).toFixed(2)+F[t]}function J(e,t){return`${e}__${t}`}function z(e,t,s){const n=t[s]??0;t[s]=n+e}
const G=z.bind(null,1),Y=z.bind(null,-1),K=h.enabled("widget")?"studies_metadata_widget":"studies_metadata",X="/chart-api/pro_hash",Z=h.enabled("widget")?"/chart-api/studies_metadata_widget":"/chart-api/studies_metadata";function ee(e){if(null===e)return"";if("period-back"===e.type){let t=e.value;return"YTD"!==t&&"D"===t.slice(-1)&&(t=t.slice(0,-1)),t}return"r,"+e.from+":"+e.to}let te=null;function se(){if(null===te){const e=document.querySelector('link[rel~="conversions-config"]'),t=new URL((0,r.ensureNotNull)(e).href);te=(0,g.fetch)(t.toString(),{method:"GET"}).then((e=>{if(!e.ok)throw new Error("Response status is not success");return e.json()})).then((e=>{const t=(0,w.getLogoUrlResolver)();return e.currencies.forEach((e=>{void 0!==e.logoid&&(e.logoUrl=t.getSymbolLogoUrl(e.logoid,w.LogoSize.Medium))})),e}))}return te}class ne{constructor(e){this.sessionid=null,this._banInfo=new M.WatchedValue(null),this._isAuthTokenLoaded=!1,this._authTokenDfd=null,this._serverTimeBasePoint=Date.now()-performance.now(),this._initCachePromise=(0,b.createCache)("TVChartApi"),this._trafficStats={total:0,sinceConnect:0,lastChunk:0},this._lowQualityEnabled=!1,this._brokerId="",this._sendingQueuedRequestsCount=0,this._modifyStudyMap=new Map,this._disconnectCount=0,this._isConnected=!1,this._metadataDeferredPromise=null,this._dataHandleModule=new N.JSONDataHandler,this._sessions={},this._notificationHandlers={},this._pendingMessagesQueue=[],this._loadNewBars=!1,this._metadataRequestNextNumber=1,this._fundamentalCounter={},this._studyCounter={},this._childStudyCounter={},this._studySpecs=new Map,this._connectionsLimitReached=new M.WatchedValue(!1),this._sentMethodsCounters=new Map,this._receivedMethodsCounters=new Map,this._requestDataProblemsPromise=null,this._wsBackendConnection=e,this._wsBackendConnection.onReconnect(this._bindSocketEvents.bind(this)),this._wsBackendConnection.setLogger(I,a.getLogHistory),this._wsBackendConnection.setTelemetry(v.telemetry),this._bindSocketEvents(),this._isNonCountedStudy=()=>!0,setInterval((()=>{L.logNormal("Last 30 seconds:"+j(this._trafficStats.lastChunk)+" Since last connect:"+j(this._trafficStats.sinceConnect)+" Total traffic:"+j(this._trafficStats.total)),this._trafficStats.lastChunk=0}),3e4),this._connectionsLimitReached.subscribe((e=>{e&&this.disconnect()}))}connect(e){this._connectOnlyOptions=e,this._wsBackendConnection.isConnected()||this._wsBackendConnection.isConnecting()||this._wsBackendConnection.connect()}disconnect(){this._wsBackendConnection.disconnect()}sentMethodsCounters(){return this._sentMethodsCounters}receivedMethodsCounters(){return this._receivedMethodsCounters}defaultResolutions(){return(0,c.getDefaultResolutions)()}availableCurrencies(){return se().then((e=>e.currencies))}availableUnits(){return se().then((e=>{const t={};for(const s of e.units)t[s.type]||(t[s.type]=[]),t[s.type].push(s);return t}))}availablePriceSources(){return Promise.resolve([])}supportedSymbolsTypes(){const e=window.TradingView?.widgetCustomer??""
;return"bovespa"===e?m.filter((e=>["","stock","futures","index"].includes(e.value))):"cme"===e?m.filter((e=>e.value!==u.types.QUANDL)):m}symbolsGrouping(){return{futures:/^(.+?)([12]!|\w\d{4})?$/}}connected(){return!!this._isConnected}authTokenManager(){return(0,r.ensureDefined)(this._authTokenManager)}createSession(e,t){this._sessions[e]=t,this._notificationHandlers[e]={},this.connected()&&this._isAuthTokenLoaded&&t.onMessage({method:l.ChartApiMessageMethod.Connected,params:[]})}removeSession(e){delete this._sessions[e],delete this._notificationHandlers[e]}disconnectCount(){return this._disconnectCount||0}getPingInfo(){return this._wsBackendConnection.getPingInfo()}connectionBanInfo(){return this._banInfo.readonly()}connectionsLimitReached(){return this._connectionsLimitReached.readonly()}serverTime(){return Math.round(this._serverTimeBasePoint+performance.now())}compensateConnectionLag(e){const t=this.serverTime(),s=Math.floor(e-t);s>0&&(this._serverTimeBasePoint+=s)}setBroker(e){return e===this._brokerId||(this._brokerId=e,this._sendBrokerIdToSession(this._brokerId))}chartCreateSession(e,t){return this._sendRequest("chart_create_session",[e,t])}chartDeleteSession(e){return this._sendRequest("chart_delete_session",[e])}switchTimezone(e,t){return this._sendRequest("switch_timezone",[e,t])}resolveSymbol(e,t,s,n){return v.telemetry.timeCounters.series["resolve_symbol_"+e]=window.performance.now(),this._notificationHandlers[e][t]=new D.HandlerInfo(n,t,!0),this._sendRequest("resolve_symbol",[e,t,s])}requestFirstBarTime(e,t,s,n){return this._notificationHandlers[e][t]=new D.HandlerInfo(n,t,!0),this._sendRequest("get_first_bar_time",[e,t,s])}createSeries(e,t,s,n,o,i,r,a){v.telemetry.timeCounters.series.marks.push("create_series_"+e),this._notificationHandlers[e][t]=new D.HandlerInfo(a,t);const d=ee(r);return this._sendRequest("create_series",[e,t,s,n,o,i,d])}removeSeries(e,t){return delete this._notificationHandlers[e][t],this._sendRequest("remove_series",[e,t])}modifySeries(e,t,s,n,o,i,r,a){this._notificationHandlers[e][t]=new D.HandlerInfo(a,t);const d=ee(r);return this._sendRequest("modify_series",[e,t,s,n,o,d])}getStudyCounter(e){return this._studyCounter[e]??0}getFundamentalCounter(e){return this._fundamentalCounter[e]??0}requestMoreData(e,t,s,n){if(void 0===s||void 0===n)throw new Error("unsupported request to load more data, bars="+s);const o=t;return this._notificationHandlers[e][o]=new D.HandlerInfo(n,o),this._sendRequest("request_more_data",[e,o,s])}requestMoreTickmarks(e,t,s,n){return n&&(this._notificationHandlers[e][t]=new D.HandlerInfo(n,t)),this._sendRequest("request_more_tickmarks",[e,t,s])}setFutureTickmarksMode(e,t){this._sendRequest("set_future_tickmarks_mode",[e,t])}requestDataProblems(){return this._requestDataProblemsPromise||(this._requestDataProblemsPromise=this.connectDfd.then((()=>new Promise(((e,t)=>{this._onDataProblemsPromiseErrback=t,this._sendRequest("request_data_problems",[])?this._onDataProblemsPromiseCb=e:t()})))).finally((()=>{this._requestDataProblemsPromise=null}))),
this._requestDataProblemsPromise}async requestMetadata(){return null===this._metadataDeferredPromise&&(this._metadataDeferredPromise=(0,f.createDeferredPromise)(),this._metadataDeferredPromise.promise.finally((()=>{this._metadataDeferredPromise=null})),this._requestMetadata()),this._metadataDeferredPromise.promise}allStudiesMetadata(){throw new Error("This method is not implemented")}setLoadNew(e){this._loadNewBars=!!e}setIsNonCountedStudyFn(e){this._isNonCountedStudy=e}canCreateStudy(e,t,s){const{id:n,child:o,fundamental:i}=t,a=(0,r.ensureNotNull)((0,C.getConfig)("STUDY_ON_STUDY")).child_limit;if(o&&(!(0,C.enabled)("STUDY_ON_STUDY")||(this._childStudyCounter[e]??0)>=a))return{success:!1,reason:"child",limitValue:a};if(s)return{success:!0};const d=(0,r.ensureNotNull)((0,C.getConfig)("FUNDAMENTALS_ON_CHART")).limit;if(i&&(!(0,C.enabled)("FUNDAMENTALS_ON_CHART")||this.getFundamentalCounter(e)>=d))return{success:!1,reason:"fundamental",limitValue:d};const l=(0,r.ensureNotNull)((0,C.getConfig)("INDICATORS_ON_CHART")).limit;return i||this._isNonCountedStudy(n)||(0,C.enabled)("INDICATORS_ON_CHART")&&!(this.getStudyCounter(e)>=l)?{success:!0}:{success:!1,reason:"general",limitValue:l}}createStudy(e,t,s,n,o,i,r,a){const d=this.canCreateStudy(e,a);return d.success||"child"!==d.reason?(this._notificationHandlers[e][t]=new D.HandlerInfo(r,t),this._sendRequest("create_study",[e,t,s,n,o,i]),a.fundamental?G(this._fundamentalCounter,e):this._isNonCountedStudy(a.id)||G(this._studyCounter,e),a.child&&G(this._childStudyCounter,e),this._studySpecs.set(J(e,t),a),!0):((0,p.showTooManyStudiesNotice)(d.limitValue),!1)}modifyStudy(e,t,s,n,i,a){z(a=a??0,this._childStudyCounter,e),0!==a&&((0,r.ensureDefined)(this._studySpecs.get(J(e,t))).child=a>0),this._notificationHandlers[e][t]=new D.HandlerInfo(i,t);const d=e+t;if(this._modifyStudyMap.has(d)){return(0,r.ensureDefined)(this._modifyStudyMap.get(d))(e,t,s,n)??!0}{const i=(0,o.default)(((e,t,s,n)=>this._sendRequest("modify_study",[e,t,s,n])),500,{maxWait:550});return this._modifyStudyMap.set(d,i),i(e,t,s,n)??!0}}notifyStudy(e,t,s,n){return I.logNormal(`Send notify_study, [${e}, ${t}, ${s}, ${JSON.stringify(n)}]`),this._sendRequest("notify_study",[e,t,s,JSON.stringify(n)])}removeStudy(e,t){const s=e+t;delete this._notificationHandlers[e][t],this._modifyStudyMap.get(s)?.flush();const n=this._sendRequest("remove_study",[e,t]);if(!1===n)return!1;this._modifyStudyMap.delete(s);const o=J(e,t),i=(0,r.ensureDefined)(this._studySpecs.get(o));return this._studySpecs.delete(o),i.fundamental?Y(this._fundamentalCounter,e):this._isNonCountedStudy(i.id)||Y(this._studyCounter,e),i.child&&Y(this._childStudyCounter,e),n}createPointset(e,t,s,n,o,i,r){return this._notificationHandlers[e][t]=new D.HandlerInfo(r,t),this._sendRequest("create_pointset",[e,t,s,n,o,i])}modifyPointset(e,t,s,n,o){return this._notificationHandlers[e][t]=new D.HandlerInfo(o,t),this._sendRequest("modify_pointset",[e,t,s,n])}removePointset(e,t){return delete this._notificationHandlers[e][t],this._sendRequest("remove_pointset",[e,t])}
getMarks(e,t,s,n,o){throw Error("This method is not implemented")}getTimescaleMarks(e,t,s,n,o){throw Error("This method is not implemented")}quoteCreateSession(e){return this._sendRequest("quote_create_session",[e])}quoteDeleteSession(e){return this._sendRequest("quote_delete_session",[e])}quoteAddSymbols(e,t){return this._sendRequest("quote_add_symbols",[e,t])}quoteRemoveSymbols(e,t){return this._sendRequest("quote_remove_symbols",[e,t])}quoteFastSymbols(e,t){return this._sendRequest("quote_fast_symbols",[e,t])}quoteSetFields(e,t){return this._sendRequest("quote_set_fields",[e,t])}quoteHibernateAll(e){return this._sendRequest("quote_hibernate_all",[e])}depthCreateSession(e,t,s){return this._sendRequest("depth_create_session",[e,t,s])}depthDeleteSession(e){return this._sendRequest("depth_delete_session",[e])}depthSetSymbol(e,t){return this._sendRequest("depth_set_symbol",[e,t])}depthClearSymbol(e){return this._sendRequest("depth_clear_symbol",[e])}depthSetScale(e,t){return this._sendRequest("depth_set_scale",[e,t])}unpack(e){return this._dataHandleModule.unpack(e)}sendRequest(e,t){return this._sendRequest(e,t)}enableLowQualityMode(){this._lowQualityEnabled=!0,this._sendLowQualityModeIfEnabled()}resetCache(){throw new Error("This method should only be called in Charting Library")}_init(){this._notificationHandlers={},this._studyCounter={},this._childStudyCounter={},this._fundamentalCounter={},this._modifyStudyMap=new Map}_sendRequest(e,t){const s=this._sentMethodsCounters.get(e)??0;if(this._sentMethodsCounters.set(e,s+1),0!==this._sendingQueuedRequestsCount)return this._pendingMessagesQueue.push({method:e,args:t}),!0;const n=this._dataHandleModule[e].apply(this._dataHandleModule,t),o={m:e,p:n},i=JSON.stringify(o);if(n.length>0){const e=n[0];e.startsWith("qs_")?O.logNormal("send: "+i):e.startsWith("cs_")&&H.logNormal("send: "+i)}else I.logNormal("send: "+i);const r=this._dataHandleModule.prepareEncodeMessage(e,n);return this._wsBackendConnection.send(r)}_onConnect(){if(this.connected())return;if(this._trafficStats.sinceConnect=0,this._isAuthTokenLoaded=!1,this._connectOnlyOptions=this._connectOnlyOptions||{},this._authTokenDfd=this._getAuthTokenDfd(this._connectOnlyOptions.tokenGrabSession),this._connectOnlyOptions={},this.sessionid=this._wsBackendConnection.getSessionId(),!this.sessionid||this._isConnected)return;this._pendingMessagesQueue=[],this._sendingQueuedRequestsCount=0,this._studyCounter={},this._childStudyCounter={},this._fundamentalCounter={},this._studySpecs.clear(),this._isConnected=!0,this._banInfo.setValue(null),this._connectionsLimitReached.setValue(!1);const e=JSON.parse(this.sessionid);this._sendLowQualityModeIfEnabled(),this._metadataServerHash=e.studies_metadata_hash||null;const t=this._wsBackendConnection.getConnectionEstablished();try{this._serverTimeBasePoint=Math.round(e.timestampMs-t)}catch(e){this._serverTimeBasePoint=Date.now()-performance.now()}if(I.logInfo("Time shift with server: "+this._formatTime(this.serverTime()-Date.now())),this._authTokenDfd){this._sendingQueuedRequestsCount+=1,
I.logInfo("Wait for auth token before send messages");const e=this._authTokenDfd;e.then((t=>{if(null!==this._authTokenDfd&&this._authTokenDfd===e){if(I.logNormal("Auth token request is finished, token: "+Boolean(t)),this._authTokenDfd=null,t){const e=[{method:"set_auth_token",args:[t]}];if($){const t=window.initData&&window.initData.currentLocaleInfo;t&&e.push({method:"set_locale",args:[t.iso,t.flag.toUpperCase()]})}this._pendingMessagesQueue.unshift(...e)}this._onSendingQueueRequestFinished(),this._isAuthTokenLoaded=!0,this._notifySessions({method:l.ChartApiMessageMethod.Connected,params:[]})}else I.logNormal("Comes auth token after requesting new token or after socket disconnected")})).catch((e=>{I.logNormal((0,y.errorToString)(e))}))}else I.logWarn("Deferred auth token object is not valid"),this._isAuthTokenLoaded=!0;""!==this._brokerId&&this._sendBrokerIdToSession(this._brokerId);const s=this._wsBackendConnection.getConnectionStart();v.telemetry.setSessionInfo(this.sessionid),v.telemetry.sendChartReport("websocket_connected"),v.telemetry.sendChartReport("websocket_connection_time_frame",{value:t-s}),v.telemetry.sendChartReport("reconnect_count_frame",{value:this._wsBackendConnection.getReconnectCount()}),v.telemetry.sendChartReport("redirect_count_frame",{value:this._wsBackendConnection.getRedirectCount()}),Q||(Q=!0,v.telemetry.sendChartReport("before_websocket_connection_time_frame",{value:s})),this._wsBackendConnection.resetCounters(),clearTimeout(this._telemetryDisconnectTimeout)}_formatTime(e){return`${(e/1e3).toFixed(2)} seconds.`}_dispatchNotification(e,t){if("request_data_problems"===e.method&&this._onDataProblemsPromiseCb)return void this._onDataProblemsPromiseCb(e.params);if(e.method===T.WebchartChartSessionResponseMethod.StudiesMetadata&&null!==this._metadataDeferredPromise)return void this._processedMetadata(e);const s=e.params.shift();if(!this._notificationHandlers[s])return;if("symbol_resolved"===e.method){const t=e.params[1].full_name;v.telemetry.sendChartReport("symbol_resolved",{count:1,additional:{symbol:t}});const n=v.telemetry.timeCounters.series["resolve_symbol_"+s];"number"==typeof n&&v.telemetry.sendChartReport("symbol_resolve_time_frame",{value:window.performance.now()-n,additional:{symbol:t}})}if(["series_error","series_completed"].includes(e.method)&&v.telemetry.timeCounters.series.marks.length>0){const e="create_series_"+s,t=v.telemetry.timeCounters.series.marks.indexOf(e);t>=0&&v.telemetry.timeCounters.series.marks.splice(t,1)}W||"series_error"!==e.method||(W=!0);const n=this._wsBackendConnection.getConnectionEstablished();if(null!==n&&"series_completed"===e.method&&(W||(W=!0,v.telemetry.sendChartReport("first_series_full_time_frame",{value:window.performance.now()-n}),v.telemetry.timeCounters.series.marks=[]),V||(V=!0,v.telemetry.sendChartReport("page_full_load_time_frame",{value:window.performance.now()}))),s.startsWith("cs_")){let s="recv: "+t;"data_update"===e.method?(s=(0,a.isHighRateEnabled)()?s:s.slice(0,500),
A.logNormal(this._appendDuration(s,e.time))):"study_loading"===e.method?E.logNormal(this._appendDuration(s,e.time)):"tickmark_update"===e.method?U.logNormal(this._appendDuration(s,e.time)):H.logNormal(this._appendDuration(s,e.time))}if(s.startsWith("qs_")){("quote_symbol_data"===e.method?B.logNormal:O.logNormal)("recv: "+t)}switch(e.method){case T.WebchartChartSessionResponseMethod.TimeScaleUpdate:{const t=this._dataHandleModule.getTimescaleObjects(e),n=this._dataHandleModule.getTimescaleChangeset(e),o=this._convertTimescaleResponse(n);this._sessions[s].onMessage({method:T.WebchartChartSessionResponseMethod.TimeScaleUpdate,params:o}),this._dataHandleModule.prepareDataUpdateObjects(s,t,((e,t,s)=>{this._invokeNotificationHandler(e,t,s)}));break}case"tickmark_update":const t={...this._convertTimescaleResponse(e.params[0]),changes:[]};this._sessions[s].onMessage({method:T.WebchartChartSessionResponseMethod.TimeScaleUpdate,params:t});break;case T.WebchartChartSessionResponseMethod.DataUpdate:{const t=this._dataHandleModule.getDataUpdateObjects(e);this._dataHandleModule.prepareDataUpdateObjects(s,t,((e,t,s)=>{this._invokeNotificationHandler(e,t,s)}));break}case"index_update":for(const t in e.params[0])if(e.params[0].hasOwnProperty(t)){const n={method:"index_update",params:e.params[0][t]};this._invokeNotificationHandler(s,t,n)}break;case T.WebchartResponseMethod.CriticalError:I.logInfo(new Date+" critical_error session:"+this.sessionid+" reason:"+e.params[0]),v.telemetry.sendChartReport("critical_error"),this._sessions[s].onMessage({method:T.WebchartResponseMethod.CriticalError,params:e.params});break;case"timescale_completed":case"quote_symbol_data":case"quote_list_fields":case"quote_completed":case"depth_symbol_error":case"depth_symbol_success":case"dd":case"dpu":case"depth_bar_last_value":this._sessions[s].onMessage({method:e.method,params:e.params});break;case"clear_data":for(const t in e.params[0])e.params[0].hasOwnProperty(t)&&this._invokeNotificationHandler(s,t,{method:T.WebchartChartSessionResponseMethod.ClearData,params:e.params[0][t]});break;case T.WebchartReplaySessionResponseMethod.ReplayPoint:case T.WebchartReplaySessionResponseMethod.ReplayResolutions:case T.WebchartReplaySessionResponseMethod.ReplayDataEnd:case T.WebchartReplaySessionResponseMethod.ReplayInstanceId:case T.WebchartReplaySessionResponseMethod.ReplayDepth:case T.WebchartReplaySessionResponseMethod.ReplayError:case T.WebchartReplaySessionResponseMethod.ReplayOk:this._sessions[s].onMessage(e);break;case"series_timeframe":e.params[4]=function(e){if(null==e)return null;const t=/r,(\d+):(\d+)/.exec(e);return null!==t?{from:Number(t[1]),to:Number(t[2]),type:"time-range"}:{value:e,type:"period-back"}}(e.params[4]),this._invokeNotificationHandler(s,e.params[0],e);break;case"symbol_resolved":!function(e){if(void 0===e.corrections){const t=(e.subsessions??[]).find((t=>t.id===e.subsession_id));void 0!==t&&(e.corrections=t["session-correction"])}}(e.params[1]),this._invokeNotificationHandler(s,e.params[0],e);break;default:
this._invokeNotificationHandler(s,e.params[0],e)}}_notifySessions(e){for(const t in this._sessions)if(this._sessions.hasOwnProperty(t)){const s=this._sessions[t];"function"==typeof s.onMessage&&s.onMessage(e)}}_onMessage(e){this._calcTrafficStats(e);const t=this.unpack(e);this._receivedMethodsCounters.set(t.method,(this._receivedMethodsCounters.get(t.method)??0)+1),"t_ms"in t&&(0,i.default)(t.t_ms)&&window.ChartApiInstance.compensateConnectionLag(t.t_ms),"protocol_switched"!==t.method?"protocol_error"!==t.method?this._dispatchNotification(t,e):this._processProtocolError(t):I.logError("Unexpected protocol changing request, try skipping. Requested protocol:"+t.params[0])}async _processedMetadata(e){const t=(0,r.ensureNotNull)(this._metadataDeferredPromise),s=await this._initCachePromise,o=window.pro.hash(),i=h.enabled("widget");try{await s.setValue(Z,(0,n.default)(e));const r=Array.from(new Set(e.params[1].metainfo.map((e=>{return`${(t=(0,q.parseIdString)(e.id)).packageId}-${t.version}`;var t}))));if(I.logNormal(`Updated studies_metadata cache, unique package ids: ${r.join(", ")}`),!i)try{await s.setValue(X,(0,n.default)(o)),I.logNormal("Updated pro_hash cache")}catch(e){t.reject(),I.logError("Cannot update pro_hash cache, reason: "+e)}}catch(e){t.reject(),I.logError("Cannot update studies_metadata cache, reason: "+e)}t.resolve((0,n.default)(e))}_invokeNotificationHandler(e,t,s){if(void 0===t)return;const n=this._notificationHandlers[e][t];void 0!==n&&(n.singleShot&&delete this._notificationHandlers[e][t],n.handler?.(s))}_convertTimescaleResponse(e){return this._dataHandleModule.convertTimescaleResponse(e)}_appendDuration(e,t){return t?`${e}, duration: ${this._formatTime(this.serverTime()-1e3*t)}`:e}async _requestMetadata(){const e=this._makeNextRequestId();P.logNormal(`Requesting metainfo #${e}`);const t=(0,r.ensureNotNull)(this._metadataDeferredPromise),s=window.pro,o=s.hash(),i=h.enabled("widget");I.logNormal("Requesting pro hash");try{const r=await this._initCachePromise;await r.migrateValue("pro_hash",X),await r.migrateValue(K,Z);const a=await r.getValue(X);if(null!==a&&a===o||i){I.logNormal("Pro hash has not changed, requesting from local");const i=await r.getValue(Z),a=null!==i&&i.params[1].hash||null;if(null===a||null===this._metadataServerHash||this._metadataServerHash!==a)I.logNormal(`Metadata hash has changed (cached: '${a}', server: '${this._metadataServerHash}')`),this._requestMetadataFromServer(e);else{if(!s.hasPackage("tv-volumebyprice")||void 0!==i.params[1].metainfo.find((e=>e.id.includes("@tv-volumebyprice"))))return I.logNormal("Using studies_metadata from browser cache"),void t.resolve((0,n.default)(i));I.logNormal(`De-sync detected! pro.hash contains VbPR studies, but data from cache doesn't and pro.hash isn't changed, pro.hash=${o}`),this._requestMetadataFromServer(e)}}else I.logNormal(`Pro hash has changed (cached: '${a}', current: '${o}')`),this._requestMetadataFromServer(e)}catch(t){I.logError("Cannot get studies_metadata, reason: "+t),this._requestMetadataFromServer(e)}finally{
P.logNormal(`Requesting studies metadata #${e} finished`)}}_makeNextRequestId(){return"metadata_"+this._metadataRequestNextNumber++}_processProtocolError(e){const t=e.params[0];I.logError(`Protocol error. Reason=${t}.`),"banned"!==t&&"banned by user_id"!==t&&"banned by ip"!==t||(this._banInfo.setValue({reason:t}),this.disconnect()),this._connectionsLimitReached.setValue("user connections limit reached"===t)}_requestMetadataFromServer(e){return I.logNormal("Request studies_metadata from server"),this._sendRequest("request_studies_metadata",[e])}_bindSocketEvents(){this.connectDfd=new Promise(((e,t)=>{this._wsBackendConnection.on("connect",(()=>{this._onConnect(),e()})),this._wsBackendConnection.on("message",this._onMessage.bind(this)),this._wsBackendConnection.on("disconnect",(()=>{this._authTokenDfd&&(this._authTokenDfd=null),this._onDataProblemsPromiseErrback&&this._onDataProblemsPromiseErrback(),this._isConnected=!1,this._notifySessions({method:l.ChartApiMessageMethod.Disconnected,params:[]}),this._banInfo.value()||(this._metadataDeferredPromise=null),this._disconnectCount=(this._disconnectCount||0)+1,this._wsBackendConnection.isConnected()&&(this._telemetryDisconnectTimeout=setTimeout((()=>{v.telemetry.sendChartReport("disconnect")}),5e3),this._wsBackendConnection.isMaxReconnects()&&(this._notifySessions({method:l.ChartApiMessageMethod.ReconnectBailout,params:[]}),t(),v.telemetry.sendChartReport("reconnect_bailout")))}))}))}_calcTrafficStats(e){const t=e.length;this._trafficStats.total+=t,this._trafficStats.sinceConnect+=t,this._trafficStats.lastChunk+=t}_sendBrokerIdToSession(e){return!x||this._sendRequest("set_broker",[e])}_sendLowQualityModeIfEnabled(){this._lowQualityEnabled&&this.connected()&&this._sendRequest("set_data_quality",[])}_getAuthTokenDfd(e){if(this._loadNewBars)return Promise.resolve("load_new_token");if(h.enabled("widget")||-1!==window.location.search.indexOf("widget_token")||-1!==window.location.hash.indexOf("widget_token")){const e=window.TradingView&&window.TradingView.widgetCustomer||"";return Promise.resolve(_[e]||"widget_user_token")}return window.is_authenticated?(this._authTokenManager||(this._authTokenManager=new d.AuthToken,this._authTokenManager.invalidated.subscribe(null,(()=>{this._authTokenManager?.get().then((e=>{e&&this.connected()&&this._sendRequest("set_auth_token",[e])}))}))),this._authTokenManager.get(e)):Promise.resolve("unauthorized_user_token")}_onSendingQueueRequestFinished(){this._sendingQueuedRequestsCount-=1,I.logInfo(`Sending queue request finished. Remaining pending requests=${this._sendingQueuedRequestsCount}`),this._sendingQueuedRequestsCount<0&&I.logError(`Invalid queue state=${this._sendingQueuedRequestsCount}`),0===this._sendingQueuedRequestsCount&&this._flushPendingMessages()}_flushPendingMessages(){I.logInfo(`Flush pending messages. Count=${this._pendingMessagesQueue.length}`),this._pendingMessagesQueue.forEach((e=>this._sendRequest(e.method,e.args))),this._pendingMessagesQueue=[]}}window.ChartApiInstance=new ne(window.WSBackendConnection)},778003:(e,t,s)=>{
function n(e){if(void 0===e)return null;const t=e.match(/(delayed_streaming)_(\d+)/);return null===t?null:{mode:t[1],interval:parseInt(t[2])}}function o(e){const t=n(e.update_mode);return null===t||(e.update_mode=t.mode,e.update_mode_seconds=t.interval),e}s.r(t),s.d(t,{normalizeUpdateMode:()=>o,parseUpdateMode:()=>n})},547465:(e,t,s)=>{s.d(t,{Delegate:()=>i});const n=(0,s(735566).getLogger)("Common.Delegate");function o(e){return!e.singleShot}class i{constructor(){this.fire=this._fireImpl.bind(this),this._listeners=[]}subscribe(e,t,s){this._listeners.push({object:e,member:t,singleShot:!!s,skip:!1})}unsubscribe(e,t){for(let s=0;s<this._listeners.length;++s){const n=this._listeners[s];if(n.object===e&&n.member===t){n.skip=!0,this._listeners.splice(s,1);break}}}unsubscribeAll(e){for(let t=this._listeners.length-1;t>=0;--t){const s=this._listeners[t];s.object===e&&(s.skip=!0,this._listeners.splice(t,1))}}destroy(){this._listeners=[]}_fireImpl(...e){const t=this._listeners;this._listeners=this._listeners.filter(o);const s=t.length;for(let o=0;o<s;++o){const s=t[o];if(!s.skip)try{s.member.apply(s.object||null,e)}catch(e){n.logError(`${e&&(e.stack||e.message)}`)}}}}},303999:(e,t,s)=>{s.d(t,{isTicksEnabled:()=>o});var n=s(638456);s(931924);function o(){return!(0,n.onWidget)()}},659923:(e,t,s)=>{s.d(t,{showTooManyStudiesNotice:()=>i});var n=s(444372),o=s(779923);function i(e){(0,o.showWarning)({title:n.t(null,void 0,s(966719)),text:n.t(null,{replace:{number:`${e}`}},s(586146))})}},925049:(e,t,s)=>{function n(){let e,t;return{promise:new Promise(((s,n)=>{e=s,t=n})),reject:t,resolve:e}}s.d(t,{createDeferredPromise:()=>n})},927435:(e,t,s)=>{s.d(t,{prepareCurrencyValue:()=>o});var n=s(444372);function o(e){let t=[];const o=function(e){switch(e){case"PCT":return"%";case"PCTPAR":return n.t(null,{context:"_max_len_9"},s(46374));case"PCTGDP":return n.t(null,{context:"_max_len_9"},s(421685));default:return e}}(e.currency_code||e.value_unit_id||"");switch(e.measure){case"price":case"unit":t=[o,e.unit_id];break;default:t=[o]}return t.filter(Boolean).join(" / ")}}}]);